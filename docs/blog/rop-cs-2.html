<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 2.0.15"><title>Railroad Oriented Programming in C#: Part 2</title><link rel="stylesheet" href="/blog/unit-cs.6720997f.css"><base target="_parent"><script type="text/javascript" src="https://livejs.com/live.js"></script></head><body class="article"> <div id="header"> <h1>Railroad Oriented Programming in C#: Part 2</h1> </div> <div id="content"> <div class="sect1"> <h2 id="_a_result_type_supporting_the_failure_path">A Result type supporting the failure path</h2> <div class="sectionbody"> <div class="paragraph"> <p>While C# does not directory support Discriminated Unions, it does support subclassing. Since a class can have multiple subclasses, and any object is always just one of them, we can use this phenomenon to implement the notion of having two returntypes, one for success result, and one for the failure result.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-cs" data-lang="cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Result</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Success</span> : <span class="hljs-title">Result</span> { }
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Failure</span> : <span class="hljs-title">Result</span> { }
  <span class="hljs-comment">// Private constructor so we are certain that Success and Failure are the only subclasses</span>
  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Result</span> (<span class="hljs-params"></span>)</span> { }
}</code></pre> </div> </div> <div class="paragraph"> <p>However, this class does not allow us to associate any return data with either the success or the failure result. We can fix that.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-cs" data-lang="cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Result</span>&lt;<span class="hljs-title">TSuccess</span>, <span class="hljs-title">TFailure</span>&gt; {
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Success</span> : <span class="hljs-title">Result</span>&lt;<span class="hljs-title">TSuccess</span>, <span class="hljs-title">TFailure</span>&gt; {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> TSuccess SuccessValue;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Success</span>(<span class="hljs-params">TSuccess result</span>)</span>{
      SuccessValue = result;
    }
  }
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Failure</span> : <span class="hljs-title">Result</span>&lt;<span class="hljs-title">TSuccess</span>, <span class="hljs-title">TFailure</span>&gt; {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> TFailure FailureValue;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Failure</span>(<span class="hljs-params">TFailure error</span>)</span>{
      FailureValue = error;
    }
  }
  <span class="hljs-comment">// Private constructor so we are certain that Success and Failure are the only subclasses</span>
  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Result</span> (<span class="hljs-params"></span>)</span> { }
}</code></pre> </div> </div> <div class="paragraph"> <p>With this in our toolkit we can now implement our <code>GetEmailAddress</code> function from earlier with an explicit failure path.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-cs" data-lang="cs"><span class="hljs-function">Result&lt;User, <span class="hljs-built_in">string</span>&gt; <span class="hljs-title">GetUser</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> username</span>)</span> {
  <span class="hljs-keyword">var</span> user = Datastore.FindUser(username);
  <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Result&lt;User, <span class="hljs-built_in">string</span>&gt;.Failure(<span class="hljs-string">&quot;User has no email&quot;</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Result&lt;User, <span class="hljs-built_in">string</span>&gt;.Success(user);
}</code></pre> </div> </div> <div class="paragraph"> <p>Usage of this function would look something like</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-cs" data-lang="cs"><span class="hljs-keyword">var</span> result = GetUser(username);
<span class="hljs-keyword">if</span> (result <span class="hljs-keyword">is</span> Result&lt;User,<span class="hljs-built_in">string</span>&gt;.Success) {
  <span class="hljs-keyword">var</span> user = ((Result&lt;User,<span class="hljs-built_in">string</span>&gt;.Success)result).ResultValue;
  <span class="hljs-comment">// Do what you wanna do</span>
} <span class="hljs-keyword">else</span> {
  <span class="hljs-keyword">var</span> error = ((Result&lt;User,<span class="hljs-built_in">string</span>&gt;.Failure)result).ErrorValue;
  <span class="hljs-comment">// Handle the failure appropriately</span>
}</code></pre> </div> </div> <div class="paragraph"> <p>As you can see we&#8217;ve achieved an explicit failure path. When we call <code>GetUser</code> we obtain a result object and this encourages us to consider both the success and the failure case. But the code leaves much to be desired. Even more so when we need to call more than one function.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-cs" data-lang="cs"><span class="hljs-function">Result&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; <span class="hljs-title">GetEmailAddress</span>(<span class="hljs-params">User user</span>)</span>;

<span class="hljs-comment">// ...</span>

<span class="hljs-keyword">var</span> result = GetUser(username);
<span class="hljs-keyword">if</span> (result <span class="hljs-keyword">is</span> Result&lt;User, <span class="hljs-built_in">string</span>&gt;.Success) {
  <span class="hljs-keyword">var</span> user = ((Result&lt;User, <span class="hljs-built_in">string</span>&gt;.Success)result).ResultValue;
  <span class="hljs-keyword">var</span> result2 = GetEmailAddress(user);
  <span class="hljs-keyword">if</span> (result2 <span class="hljs-keyword">is</span> Result&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;.Success) {
    <span class="hljs-keyword">var</span> email = ((Result&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;.Success)result2).ResultValue;
    <span class="hljs-comment">// And so on...</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">var</span> error2 = ((Result&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;.Failure)result2).ErrorValue;
    <span class="hljs-comment">// Handle the failure appropriately</span>
  }
} <span class="hljs-keyword">else</span> {
  <span class="hljs-keyword">var</span> error = ((Result&lt;User, <span class="hljs-built_in">string</span>&gt;.Failure)result).ErrorValue;
  <span class="hljs-comment">// Handle the failure appropriately</span>
}</code></pre> </div> </div> <div class="paragraph"> <p>We would like to</p> </div> <div class="ulist"> <ul> <li> <p>not have to unwrap the result type by doing a type check + cast</p> </li> <li> <p>not have a new nesting level for each subsequent function we call</p> </li> <li> <p>not have to handle all failures individually</p> </li> <li> <p>not have to specify the whole type when creating a Result instance: <code>new Result&lt;User, string&gt;.Success()</code></p> </li> </ul> </div> <div class="sect2"> <h3 id="_a_fluent_result_type">A Fluent Result type</h3> <div class="paragraph"> <p>To resolve the complaints about our previous implementation, we&#8217;ll define an <code>OnSuccess</code> function and a <code>Handle</code> function. They will do the unwrapping for us and form a <a href="https://en.wikipedia.org/wiki/Fluent_interface">Fluent Interface</a> and thereby removing the nesting. Moreover, the OnSuccess function will "shortcircuit" the failure path, such that we only have to handle the failure path once.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-cs" data-lang="cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Result</span>&lt;<span class="hljs-title">TS</span>, <span class="hljs-title">TF</span>&gt; {
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-title">Result</span>&lt;<span class="hljs-title">TNextR</span>, <span class="hljs-title">TF</span>&gt; <span class="hljs-title">OnSuccess</span>&lt;<span class="hljs-title">TNextR</span>&gt;(<span class="hljs-params">Func&lt;TS, Result&lt;TNextR, TF&gt;&gt; onSuccess</span>)</span>;
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> TReturn <span class="hljs-title">Handle</span>&lt;<span class="hljs-title">TReturn</span>&gt;(<span class="hljs-params">Func&lt;TS, TReturn&gt; onSuccess, Func&lt;TF, TReturn&gt; onFailure</span>)</span>;

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Success</span> : <span class="hljs-title">Result</span>&lt;<span class="hljs-title">TS</span>, <span class="hljs-title">TF</span>&gt; {
    <span class="hljs-keyword">public</span> TS SuccessValue { <span class="hljs-keyword">get</span>; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Success</span>(<span class="hljs-params">TS result</span>)</span> =&gt; SuccessValue = result;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-title">Result</span>&lt;<span class="hljs-title">TNextR</span>, <span class="hljs-title">TF</span>&gt; <span class="hljs-title">OnSuccess</span>&lt;<span class="hljs-title">TNextR</span>&gt;(<span class="hljs-params">Func&lt;TS, Result&lt;TNextR, TF&gt;&gt; onSuccess</span>)</span>
        =&gt; onSuccess(SuccessValue);
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> TReturn <span class="hljs-title">Handle</span>&lt;<span class="hljs-title">TReturn</span>&gt;(<span class="hljs-params">Func&lt;TS, TReturn&gt; onSuccess, Func&lt;TF, TReturn&gt; onFailure</span>)</span>
        =&gt; onSuccess(SuccessValue);
  }

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Failure</span> : <span class="hljs-title">Result</span>&lt;<span class="hljs-title">TS</span>, <span class="hljs-title">TF</span>&gt; {
    <span class="hljs-keyword">public</span> TF FailureValue { <span class="hljs-keyword">get</span>; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Failure</span>(<span class="hljs-params">TF error</span>)</span> =&gt; FailureValue = error;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-title">Result</span>&lt;<span class="hljs-title">TNextR</span>, <span class="hljs-title">TF</span>&gt; <span class="hljs-title">OnSuccess</span>&lt;<span class="hljs-title">TNextR</span>&gt;(<span class="hljs-params">Func&lt;TS, Result&lt;TNextR, TF&gt;&gt; onSuccess</span>)</span>
        =&gt; Result.Fail(FailureValue);
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> TReturn <span class="hljs-title">Handle</span>&lt;<span class="hljs-title">TReturn</span>&gt;(<span class="hljs-params">Func&lt;TS, TReturn&gt; onSuccess, Func&lt;TF, TReturn&gt; onFailure</span>)</span>
        =&gt; onFailure(FailureValue);
  }
  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Result</span>(<span class="hljs-params"></span>)</span> { }
}</code></pre> </div> </div> <div class="paragraph"> <p>Apart from the daunting function signatures, the actual function bodies are trivial. Yet they suddenly allow us to write very concise code. Compare the following with what we had in the previous section.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-cs" data-lang="cs">GetUser(username)
  .OnSuccess(GetEmailAddress);
  .Handle(
    emailAddress =&gt; ..., <span class="hljs-comment">// Do your thing</span>
    error =&gt; ... <span class="hljs-comment">// Handle the failure appropriately</span>
  );</code></pre> </div> </div> <div class="paragraph"> <p>This style of programming is sometimes referred to as <a href="https://fsharpforfunandprofit.com/rop/"><em>railway oriented programming</em></a>, a term first invented by Scott Wlaschin. Why that is the case is easily demonstrated with some diagrams. The Result type encapsulates two "paths" or "tracks", the success track and the failure track.</p> </div> <div class="imageblock kroki"> <div class="content"> <svg xmlns="http://www.w3.org/2000/svg" class="pikchr" width="149" height="51" viewbox="0 0 187.43 64.8"> <polygon points="106,17 95,21 95,12" style="fill:#add8e6"></polygon> <path d="M34,17L100,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <polygon points="106,47 95,51 95,43" style="fill:orange"></polygon> <path d="M34,47L100,47" style="fill:none;stroke-width:2.16;stroke:orange"></path> <path d="M17,47L52,47A15 15 0 0 0 67 32A15 15 0 0 0 52 17L17,17A15 15 0 0 0 2 32A15 15 0 0 0 17 47Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="34" y="32" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">Result</text> <path d="M121,32L170,32A15 15 0 0 0 185 17A15 15 0 0 0 170 2L121,2A15 15 0 0 0 106 17A15 15 0 0 0 121 32Z" style="fill:#add8e6;stroke-width:2.16;stroke:#000"></path> <text x="145" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">Success</text> <path d="M121,62L163,62A15 15 0 0 0 178 47A15 15 0 0 0 163 32L121,32A15 15 0 0 0 106 47A15 15 0 0 0 121 62Z" style="fill:orange;stroke-width:2.16;stroke:#000"></path> <text x="142" y="47" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">Failure</text> </svg> </div> </div> <div class="paragraph"> <p>And the <code>OnSuccess</code> and <code>Handle</code> methods form trackpieces.</p> </div> <div class="imageblock kroki"> <div class="content"> <svg xmlns="http://www.w3.org/2000/svg" class="pikchr" width="307" height="41" viewbox="0 0 384.998 52.56"> <path d="M133,17 L 140,17 Q 147,17 147,31 L 147,31 Q 147,46 162,46 L 176,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <path d="M133,17L176,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <polygon points="30,17 19,21 19,12" style="fill:#add8e6"></polygon> <path d="M2,17L25,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M30,32L133,32L133,2L30,2Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="82" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">OnSuccess</text> <path d="M2,46L176,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <polygon points="277,17 265,21 265,12" style="fill:#add8e6"></polygon> <path d="M248,17L271,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <polygon points="277,46 265,50 265,41" style="fill:orange"></polygon> <path d="M248,46L271,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <path d="M277,46L349,46L349,16L277,16Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="313" y="31" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">Handle</text> <polygon points="378,31 366,36 366,27" style="fill:#000"></polygon> <path d="M349,31L372,31" style="fill:none;stroke-width:2.16;stroke:#000"></path> </svg> </div> </div> <div class="paragraph"> <p>The railway of the example code would look like</p> </div> <div class="imageblock kroki"> <div class="content"> <svg xmlns="http://www.w3.org/2000/svg" class="pikchr" width="479" height="41" viewbox="0 0 599.328 52.56"> <path d="M111,17 L 118,17 Q 125,17 125,31 L 125,31 Q 125,46 139,46 L 139,46 L 154,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <path d="M111,17L154,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M339,17 L 346,17 Q 353,17 353,31 L 353,31 Q 353,46 368,46 L 368,46 L 382,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <path d="M339,17L382,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <polygon points="30,17 19,21 19,12" style="fill:#add8e6"></polygon> <path d="M2,17L25,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M30,32L111,32L111,2L30,2Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="70" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">GetUser</text> <path d="M2,46L154,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <polygon points="183,17 171,21 171,12" style="fill:#add8e6"></polygon> <path d="M154,17L177,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M183,32L339,32L339,2L183,2Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="261" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">GetEmailAddress</text> <path d="M154,46L382,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <polygon points="411,17 400,21 400,12" style="fill:#add8e6"></polygon> <path d="M382,17L405,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <polygon points="411,46 400,50 400,41" style="fill:orange"></polygon> <path d="M382,46L405,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <path d="M411,46L483,46L483,16L411,16Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="447" y="31" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">Handle</text> <polygon points="512,31 501,36 501,27" style="fill:#000"></polygon> <path d="M483,31L506,31" style="fill:none;stroke-width:2.16;stroke:#000"></path> <path d="M527,46L582,46A15 15 0 0 0 597 31A15 15 0 0 0 582 16L527,16A15 15 0 0 0 512 31A15 15 0 0 0 527 46Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="554" y="31" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">message</text> </svg> </div> </div> </div> <div class="sect2"> <h3 id="_another_example">Another Example</h3> <div class="paragraph"> <p>Suppose now that we needed to write the following function.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-cs" data-lang="cs"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>Message to be printed on the screen<span class="hljs-doctag">&lt;/returns&gt;</span></span>
<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">MailMessageToUser</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> username, <span class="hljs-built_in">string</span> msg</span>)</span>;</code></pre> </div> </div> <div class="paragraph"> <p>And suppose that we have the following functions at our disposal.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-cs" data-lang="cs"><span class="hljs-function">Result&lt;User, <span class="hljs-built_in">string</span>&gt; <span class="hljs-title">GetUser</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> username</span>)</span>;
<span class="hljs-function">Result&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; <span class="hljs-title">GetEmailAddress</span>(<span class="hljs-params">User user</span>)</span>;
<span class="hljs-function">Result&lt;EmailMessage, <span class="hljs-built_in">string</span>&gt; <span class="hljs-title">CreateEmailMessage</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> emailAddress, <span class="hljs-built_in">string</span> msg</span>)</span>;
<span class="hljs-function">Result&lt;Unit, <span class="hljs-built_in">string</span>&gt; <span class="hljs-title">SendEmail</span>(<span class="hljs-params">EmailMessage email</span>)</span>;</code></pre> </div> </div> <div class="paragraph"> <p>If you&#8217;re wondering what that <code>Unit</code> type is, it&#8217;s a replacement for <code>void</code>, since we can&#8217;t put <code>void</code> in there. For more information <a href="/?page=unit-cs">read my respective article</a>.</p> </div> <div class="paragraph"> <p>Then we could implement the function as follows.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-cs" data-lang="cs"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>Message to be printed on the screen<span class="hljs-doctag">&lt;/returns&gt;</span></span>
<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">MailMessageToUser</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> username, <span class="hljs-built_in">string</span> msg</span>)</span> {
  <span class="hljs-keyword">return</span> GetUser(username)
    .OnSuccess(GetEmailAddress)
    .OnSuccess(email =&gt; CreateEmailMessage(email, msg))
    .OnSuccess(SendEmail)
    .Handle(
      _ =&gt; <span class="hljs-string">&quot;Email sent&quot;</span>,
      error =&gt; {
        Log(error);
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Email not sent&quot;</span>;
      }
    );
}</code></pre> </div> </div> <div class="paragraph"> <p>The railway of the example code would look like</p> </div> <div class="imageblock kroki"> <div class="content"> <svg xmlns="http://www.w3.org/2000/svg" class="pikchr" width="828" height="41" viewbox="0 0 1036.17 52.56"> <path d="M111,17 L 118,17 Q 125,17 125,31 L 125,31 Q 125,46 139,46 L 139,46 L 154,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <path d="M111,17L154,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M339,17 L 346,17 Q 353,17 353,31 L 353,31 Q 353,46 368,46 L 368,46 L 382,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <path d="M339,17L382,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M602,17 L 609,17 Q 616,17 616,31 L 616,31 Q 616,46 631,46 L 631,46 L 645,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <path d="M602,17L645,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M776,17 L 783,17 Q 790,17 790,31 L 790,31 Q 790,46 805,46 L 805,46 L 819,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <path d="M776,17L819,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <polygon points="30,17 19,21 19,12" style="fill:#add8e6"></polygon> <path d="M2,17L25,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M30,32L111,32L111,2L30,2Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="70" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">GetUser</text> <path d="M2,46L154,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <polygon points="183,17 171,21 171,12" style="fill:#add8e6"></polygon> <path d="M154,17L177,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M183,32L339,32L339,2L183,2Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="261" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">GetEmailAddress</text> <path d="M154,46L382,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <polygon points="411,17 400,21 400,12" style="fill:#add8e6"></polygon> <path d="M382,17L405,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M411,32L602,32L602,2L411,2Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="507" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">CreateEmailMessage</text> <path d="M382,46L645,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <polygon points="674,17 662,21 662,12" style="fill:#add8e6"></polygon> <path d="M645,17L668,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M674,32L776,32L776,2L674,2Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="725" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">SendEmail</text> <path d="M645,46L819,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <polygon points="848,17 836,21 836,12" style="fill:#add8e6"></polygon> <path d="M819,17L842,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <polygon points="848,46 836,50 836,41" style="fill:orange"></polygon> <path d="M819,46L842,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <path d="M848,46L920,46L920,16L848,16Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="884" y="31" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">Handle</text> <polygon points="949,31 938,36 938,27" style="fill:#000"></polygon> <path d="M920,31L943,31" style="fill:none;stroke-width:2.16;stroke:#000"></path> <path d="M964,46L1018,46A15 15 0 0 0 1034 31A15 15 0 0 0 1018 16L964,16A15 15 0 0 0 949 31A15 15 0 0 0 964 46Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="991" y="31" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">message</text> </svg> </div> </div> </div> <div class="sect2"> <h3 id="_the_onfailure_method">The OnFailure method</h3> <div class="paragraph"> <p>If we have a OnSuccess method, there is no reason why we couldn&#8217;t have an OnFailure method too. This would allow us to do operations on the failure track, such as modifying or logging the error, or recovering from the error and get back on the success track.</p> </div> <div class="imageblock kroki"> <div class="content"> <svg xmlns="http://www.w3.org/2000/svg" class="pikchr" width="137" height="38" viewbox="0 0 172.166 48.24"> <path d="M126,30 L 134,30 Q 141,30 141,16 L 141,16 Q 141,2 155,2 L 155,2 L 170,2" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M126,30L170,30" style="fill:none;stroke-width:2.16;stroke:orange"></path> <polygon points="30,30 19,35 19,26" style="fill:orange"></polygon> <path d="M2,30L25,30" style="fill:none;stroke-width:2.16;stroke:orange"></path> <path d="M30,46L126,46L126,15L30,15Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="78" y="30" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">OnFailure</text> <path d="M2,2L170,2" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> </svg> </div> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-cs" data-lang="cs"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>Message to be printed on the screen<span class="hljs-doctag">&lt;/returns&gt;</span></span>
<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">MailMessageToUser</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> username, <span class="hljs-built_in">string</span> msg</span>)</span> {
  <span class="hljs-keyword">return</span> GetUser(username)
    .OnSuccess(GetEmailAddress)
    .OnSuccess(email =&gt; CreateEmailMessage(email, msg))
    .OnSuccess(SendEmail)
    .OnFailure&lt;<span class="hljs-built_in">string</span>&gt;(error =&gt; {
      LogError(error);
      <span class="hljs-keyword">return</span> Result.Fail(error); <span class="hljs-comment">// Only log the error and leave the Failure be</span>
    })
    .Handle(
      _ =&gt; <span class="hljs-string">&quot;Email sent&quot;</span>,
      _ =&gt; <span class="hljs-string">&quot;Email not sent&quot;</span>
    );
}</code></pre> </div> </div> <div class="imageblock kroki"> <div class="content"> <svg xmlns="http://www.w3.org/2000/svg" class="pikchr" width="957" height="50" viewbox="0 0 1197.22 63.36"> <path d="M111,17 L 118,17 Q 125,17 125,31 L 125,31 Q 125,46 139,46 L 139,46 L 154,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <path d="M111,17L154,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M339,17 L 346,17 Q 353,17 353,31 L 353,31 Q 353,46 368,46 L 368,46 L 382,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <path d="M339,17L382,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M602,17 L 609,17 Q 616,17 616,31 L 616,31 Q 616,46 631,46 L 631,46 L 645,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <path d="M602,17L645,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M776,17 L 783,17 Q 790,17 790,31 L 790,31 Q 790,46 805,46 L 805,46 L 819,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <path d="M776,17L819,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M951,46L980,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <polygon points="30,17 19,21 19,12" style="fill:#add8e6"></polygon> <path d="M2,17L25,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M30,32L111,32L111,2L30,2Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="70" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">GetUser</text> <path d="M2,46L154,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <polygon points="183,17 171,21 171,12" style="fill:#add8e6"></polygon> <path d="M154,17L177,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M183,32L339,32L339,2L183,2Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="261" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">GetEmailAddress</text> <path d="M154,46L382,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <polygon points="411,17 400,21 400,12" style="fill:#add8e6"></polygon> <path d="M382,17L405,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M411,32L602,32L602,2L411,2Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="507" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">CreateEmailMessage</text> <path d="M382,46L645,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <polygon points="674,17 662,21 662,12" style="fill:#add8e6"></polygon> <path d="M645,17L668,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <path d="M674,32L776,32L776,2L674,2Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="725" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">SendEmail</text> <path d="M645,46L819,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <polygon points="848,46 836,50 836,41" style="fill:orange"></polygon> <path d="M819,46L842,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <path d="M848,61L951,61L951,30L848,30Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="900" y="46" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">LogFailure</text> <path d="M819,17L980,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <polygon points="1009,17 997,21 997,12" style="fill:#add8e6"></polygon> <path d="M980,17L1003,17" style="fill:none;stroke-width:2.16;stroke:#add8e6"></path> <polygon points="1009,46 997,50 997,41" style="fill:orange"></polygon> <path d="M980,46L1003,46" style="fill:none;stroke-width:2.16;stroke:orange"></path> <path d="M1009,46L1081,46L1081,16L1009,16Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="1045" y="31" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">Handle</text> <polygon points="1110,31 1099,36 1099,27" style="fill:#000"></polygon> <path d="M1081,31L1104,31" style="fill:none;stroke-width:2.16;stroke:#000"></path> <path d="M1125,46L1179,46A15 15 0 0 0 1195 31A15 15 0 0 0 1179 16L1125,16A15 15 0 0 0 1110 31A15 15 0 0 0 1125 46Z" style="fill:none;stroke-width:2.16;stroke:#000"></path> <text x="1152" y="31" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">message</text> </svg> </div> </div> <div class="paragraph"> <p>We still need to deal with the awkward construction of Result instances, and we&#8217;ll do that in the next part.</p> </div> </div> </div> </div> </div> <div id="footer"> <div id="footer-text"> Last updated 2021-08-02 10:53:13 +0200 </div> </div> </body></html>