<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 2.0.15"><title>Railroad Oriented Programming in C#</title><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"><style>article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;font-family:sans-serif}a{background:none}a:focus{outline:thin dotted}a:active,a:hover{outline:0}h1{font-size:2em;margin:.67em 0}abbr[title]{border-bottom:1px dotted}dfn{font-style:italic}hr{-moz-box-sizing:content-box;box-sizing:content-box}mark{background:#ff0;color:#000}code,kbd,pre,samp{font-family:monospace;font-size:1em}pre{white-space:pre-wrap}q{quotes:"\201C" "\201D" "\2018" "\2019"}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:0}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}button,input{line-height:normal}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}textarea{overflow:auto;vertical-align:top}table{border-collapse:collapse;border-spacing:0}*,:after,:before{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}body,html{font-size:100%}body{word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;background:#fff;color:rgba(0,0,0,.8);cursor:auto;font-family:"Noto Serif","DejaVu Serif",serif;font-style:normal;font-weight:400;line-height:1;margin:0;padding:0;position:relative;tab-size:4}a:hover{cursor:pointer}embed,img,object{height:auto;max-width:100%}embed,object{height:100%}img{-ms-interpolation-mode:bicubic}.left{float:left!important}.right{float:right!important}.text-left{text-align:left!important}.text-right{text-align:right!important}.text-center{text-align:center!important}.text-justify{text-align:justify!important}.hide{display:none}img,object,svg{display:inline-block;vertical-align:middle}textarea{height:auto;min-height:50px}select{width:100%}.admonitionblock td.content>.title,.audioblock>.title,.dlist>.title,.exampleblock>.title,.hdlist>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.olist>.title,.openblock>.title,.paragraph>.title,.qlist>.title,.quoteblock>.title,.stemblock>.title,.subheader,.ulist>.title,.verseblock>.title,.videoblock>.title,table.tableblock>.title{color:#7a2518;font-weight:400;line-height:1.45;margin-bottom:.25em;margin-top:0}#toctitle,.sidebarblock>.content>.title,blockquote,dd,div,dl,dt,form,h1,h2,h3,h4,h5,h6,li,ol,p,pre,td,th,ul{margin:0;padding:0}a{color:#2156a5;line-height:inherit;text-decoration:underline}a:focus,a:hover{color:#1d4b8f}a img{border:0}p{text-rendering:optimizeLegibility;font-family:inherit;font-size:1em;font-weight:400;line-height:1.6;margin-bottom:1.25em}p aside{font-size:.875em;font-style:italic;line-height:1.35}#toctitle,.sidebarblock>.content>.title,h1,h2,h3,h4,h5,h6{text-rendering:optimizeLegibility;color:#ba3925;font-family:Open Sans,DejaVu Sans,sans-serif;font-style:normal;font-weight:300;line-height:1.0125em;margin-bottom:.5em;margin-top:1em}#toctitle small,.sidebarblock>.content>.title small,h1 small,h2 small,h3 small,h4 small,h5 small,h6 small{color:#e99b8f;font-size:60%;line-height:0}h1{font-size:2.125em}h2{font-size:1.6875em}#toctitle,.sidebarblock>.content>.title,h3{font-size:1.375em}h4,h5{font-size:1.125em}h6{font-size:1em}hr{border:solid #dddddf;border-width:1px 0 0;clear:both;height:0;margin:1.25em 0 1.1875em}em,i{font-style:italic}b,em,i,strong{line-height:inherit}b,strong{font-weight:700}small{font-size:60%;line-height:inherit}code{color:rgba(0,0,0,.9);font-family:Droid Sans Mono,DejaVu Sans Mono,monospace;font-weight:400}dl,ol,ul{font-family:inherit;font-size:1em;line-height:1.6;list-style-position:outside;margin-bottom:1.25em}ol,ul{margin-left:1.5em}ul li ol,ul li ul{font-size:1em;margin-bottom:0;margin-left:1.25em}ul.circle li ul,ul.disc li ul,ul.square li ul{list-style:inherit}ul.square{list-style-type:square}ul.circle{list-style-type:circle}ul.disc{list-style-type:disc}ol li ol,ol li ul{margin-bottom:0;margin-left:1.25em}dl dt{font-weight:700;margin-bottom:.3125em}dl dd{margin-bottom:1.25em}abbr,acronym{border-bottom:1px dotted #ddd;color:rgba(0,0,0,.8);cursor:help;font-size:90%;text-transform:uppercase}abbr{text-transform:none}blockquote{border-left:1px solid #ddd;margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em}blockquote,blockquote p{color:rgba(0,0,0,.85);line-height:1.6}@media screen and (min-width:768px){#toctitle,.sidebarblock>.content>.title,h1,h2,h3,h4,h5,h6{line-height:1.2}h1{font-size:2.75em}h2{font-size:2.3125em}#toctitle,.sidebarblock>.content>.title,h3{font-size:1.6875em}h4{font-size:1.4375em}}table{word-wrap:normal;background:#fff;border:1px solid #dedede;margin-bottom:1.25em}table tfoot,table thead{background:#f7f8f7}table tfoot tr td,table tfoot tr th,table thead tr td,table thead tr th{color:rgba(0,0,0,.8);font-size:inherit;padding:.5em .625em .625em;text-align:left}table tr td,table tr th{color:rgba(0,0,0,.8);font-size:inherit;padding:.5625em .625em}table tr.alt,table tr.even{background:#f8f8f7}table tbody tr td,table tfoot tr td,table tfoot tr th,table thead tr th,table tr td{line-height:1.6}#toctitle,.sidebarblock>.content>.title,h1,h2,h3,h4,h5,h6{line-height:1.2;word-spacing:-.05em}#toctitle strong,.sidebarblock>.content>.title strong,h1 strong,h2 strong,h3 strong,h4 strong,h5 strong,h6 strong{font-weight:400}.center{margin-left:auto;margin-right:auto}.stretch{width:100%}.clearfix:after,.clearfix:before,.float-group:after,.float-group:before{content:" ";display:table}.clearfix:after,.float-group:after{clear:both}:not(pre).nobreak{word-wrap:normal}:not(pre).nowrap{white-space:nowrap}:not(pre).pre-wrap{white-space:pre-wrap}:not(pre):not([class^=L])>code{background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em}:not(pre):not([class^=L])>code,pre{text-rendering:optimizeSpeed;line-height:1.45}pre{color:rgba(0,0,0,.9);font-family:Droid Sans Mono,DejaVu Sans Mono,monospace}pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}pre>code{display:block}pre.nowrap,pre.nowrap pre{word-wrap:normal;white-space:pre}em em{font-style:normal}strong strong{font-weight:400}.keyseq{color:rgba(51,51,51,.8)}kbd{background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;color:rgba(0,0,0,.8);display:inline-block;font-family:Droid Sans Mono,DejaVu Sans Mono,monospace;font-size:.65em;line-height:1.45;margin:0 .15em;padding:.2em .5em;position:relative;top:-.1em;vertical-align:middle;white-space:nowrap}.keyseq kbd:first-child{margin-left:0}.keyseq kbd:last-child{margin-right:0}.menuref,.menuseq{color:#000}.menuref,.menuseq b:not(.caret){font-weight:inherit}.menuseq{word-spacing:-.02em}.menuseq b.caret{font-size:1.25em;line-height:.8}.menuseq i.caret{font-weight:700;text-align:center;width:.45em}b.button:after,b.button:before{font-weight:400;position:relative;top:-1px}b.button:before{content:"[";padding:0 3px 0 2px}b.button:after{content:"]";padding:0 2px 0 3px}p a>code:hover{color:rgba(0,0,0,.9)}#content,#footer,#footnotes,#header{*zoom:1;margin:0 auto;max-width:62.5em;padding-left:.9375em;padding-right:.9375em;position:relative;width:100%}#content:after,#content:before,#footer:after,#footer:before,#footnotes:after,#footnotes:before,#header:after,#header:before{content:" ";display:table}#content:after,#footer:after,#footnotes:after,#header:after{clear:both}#content{margin-top:1.25em}#content:before{content:none}#header>h1:first-child{color:rgba(0,0,0,.85);margin-bottom:0;margin-top:2.25rem}#header>h1:first-child+#toc{border-top:1px solid #dddddf;margin-top:8px}#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}#header .details{border-bottom:1px solid #dddddf;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;line-height:1.45;padding-bottom:.25em;padding-left:.25em;padding-top:.25em}#header .details span:first-child{margin-left:-.125em}#header .details span.email a{color:rgba(0,0,0,.85)}#header .details br{display:none}#header .details br+span:before{content:"\00a0\2013\00a0"}#header .details br+span.author:before{color:rgba(0,0,0,.85);content:"\00a0\22c5\00a0"}#header .details br+span#revremark:before{content:"\00a0|\00a0"}#header #revnumber{text-transform:capitalize}#header #revnumber:after{content:"\00a0"}#content>h1:first-child:not([class]){border-bottom:1px solid #dddddf;color:rgba(0,0,0,.85);margin-bottom:1.25rem;margin-top:0;padding-bottom:8px;padding-top:1rem}#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}#toc>ul{margin-left:.125em}#toc ul.sectlevel0>li>a{font-style:italic}#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}#toc ul{font-family:Open Sans,DejaVu Sans,sans-serif;list-style-type:none}#toc li{line-height:1.3334;margin-top:.3334em}#toc a{text-decoration:none}#toc a:active{text-decoration:underline}#toctitle{color:#7a2518;font-size:1.2em}@media screen and (min-width:768px){#toctitle{font-size:1.375em}body.toc2{padding-left:15em;padding-right:0}#toc.toc2{background:#f8f8f7;border-bottom-width:0!important;border-right:1px solid #e7e7e9;border-top-width:0!important;height:100%;left:0;margin-top:0!important;overflow:auto;padding:1.25em 1em;position:fixed;top:0;width:15em;z-index:1000}#toc.toc2 #toctitle{font-size:1.2em;margin-bottom:.8rem;margin-top:0}#toc.toc2>ul{font-size:.9em;margin-bottom:0}#toc.toc2 ul ul{margin-left:0;padding-left:1em}#toc.toc2 ul.sectlevel0 ul.sectlevel1{margin-bottom:.5em;margin-top:.5em;padding-left:0}body.toc2.toc-right{padding-left:0;padding-right:15em}body.toc2.toc-right #toc.toc2{border-left:1px solid #e7e7e9;border-right-width:0;left:auto;right:0}}@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}#toc.toc2{width:20em}#toc.toc2 #toctitle{font-size:1.375em}#toc.toc2>ul{font-size:.95em}#toc.toc2 ul ul{padding-left:1.25em}body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{background:#f8f8f7;border:1px solid #e0e0dc;-webkit-border-radius:4px;border-radius:4px;margin-bottom:1.25em;padding:1.25em}#content #toc>:first-child{margin-top:0}#content #toc>:last-child{margin-bottom:0}#footer{background:rgba(0,0,0,.8);max-width:none;padding:1.25em}#footer-text{color:rgba(255,255,255,.8);line-height:1.44}#content{margin-bottom:.625em}.sect1{padding-bottom:.625em}@media screen and (min-width:768px){#content{margin-bottom:1.25em}.sect1{padding-bottom:1.25em}}.sect1:last-child{padding-bottom:0}.sect1+.sect1{border-top:1px solid #e7e7e9}#content h1>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h2>a.anchor,h3>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{display:block;font-weight:400;margin-left:-1.5ex;position:absolute;text-align:center;text-decoration:none!important;visibility:hidden;width:1.5ex;z-index:1001}#content h1>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";display:block;font-size:.85em;padding-top:.1em}#content h1:hover>a.anchor,#content h1>a.anchor:hover,#toctitle:hover>a.anchor,#toctitle>a.anchor:hover,.sidebarblock>.content>.title:hover>a.anchor,.sidebarblock>.content>.title>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,h3>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}#content h1>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h2>a.link,h3>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}#content h1>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h2>a.link:hover,h3>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}.audioblock,.imageblock,.listingblock,.literalblock,.stemblock,.videoblock,details{margin-bottom:1.25em}details>summary:first-of-type{cursor:pointer;display:list-item;margin-bottom:.75em;outline:none}.admonitionblock td.content>.title,.audioblock>.title,.dlist>.title,.exampleblock>.title,.hdlist>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.olist>.title,.openblock>.title,.paragraph>.title,.qlist>.title,.quoteblock>.title,.stemblock>.title,.ulist>.title,.verseblock>.title,.videoblock>.title,table.tableblock>.title{text-rendering:optimizeLegibility;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic;text-align:left}table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}#preamble>.sectionbody>[class=paragraph]:first-of-type p,.paragraph.lead>p{color:rgba(0,0,0,.85);font-size:1.21875em;line-height:1.6}table.tableblock #preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:inherit}.admonitionblock>table{background:none;border:0;border-collapse:separate;width:100%}.admonitionblock>table td.icon{text-align:center;width:80px}.admonitionblock>table td.icon img{max-width:none}.admonitionblock>table td.icon .title{font-family:Open Sans,DejaVu Sans,sans-serif;font-weight:700;text-transform:uppercase}.admonitionblock>table td.content{word-wrap:anywhere;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);padding-left:1.125em;padding-right:1.25em}.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}.exampleblock>.content{background:#fff;border:1px solid #e6e6e6;-webkit-border-radius:4px;border-radius:4px;margin-bottom:1.25em;padding:1.25em}.exampleblock>.content>:first-child{margin-top:0}.exampleblock>.content>:last-child{margin-bottom:0}.sidebarblock{background:#f3f3f2;border:1px solid #dbdbd6;-webkit-border-radius:4px;border-radius:4px;margin-bottom:1.25em;padding:1.25em}.sidebarblock>:first-child{margin-top:0}.sidebarblock>:last-child{margin-bottom:0}.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child{margin-bottom:0}.listingblock>.content>pre,.literalblock pre{-webkit-border-radius:4px;border-radius:4px;font-size:.8125em;overflow-x:auto;padding:1em}@media screen and (min-width:768px){.listingblock>.content>pre,.literalblock pre{font-size:.90625em}}@media screen and (min-width:1280px){.listingblock>.content>pre,.literalblock pre{font-size:1em}}.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "],.literalblock pre{background:#f7f7f8}.literalblock.output pre{background:rgba(0,0,0,.9);color:#f7f7f8}.listingblock>.content{position:relative}.listingblock code[data-lang]:before{color:inherit;content:attr(data-lang);display:none;font-size:.75em;line-height:1;opacity:.5;position:absolute;right:.5rem;text-transform:uppercase;top:.425rem}.listingblock:hover code[data-lang]:before{display:block}.listingblock.terminal pre .command:before{color:inherit;content:attr(data-prompt);opacity:.5;padding-right:.5em}.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}.listingblock pre.highlightjs{padding:0}.listingblock pre.highlightjs>code{-webkit-border-radius:4px;border-radius:4px;padding:1em}.listingblock pre.prettyprint{border-width:0}.prettyprint{background:#f7f7f8}pre.prettyprint .linenums{line-height:1.45;margin-left:2em}pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}pre.prettyprint li code[data-lang]:before{opacity:1}pre.prettyprint li:not(:first-child) code[data-lang]:before{display:none}table.linenotable{background:none;border:0;border-collapse:separate;margin-bottom:0}table.linenotable td[class]{color:inherit;line-height:inherit;padding:0;vertical-align:top;white-space:normal}table.linenotable td.code{padding-left:.75em}table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}pre.pygments .lineno{border-right:1px solid;display:inline-block;margin-right:.75em;opacity:.35}pre.pygments .lineno:before{content:"";margin-right:-.125em}.quoteblock{display:table;margin:0 1em 1.25em 1.5em}.quoteblock:not(.excerpt)>.title{margin-bottom:.75em;margin-left:-1.5em}.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;font-style:italic;letter-spacing:0;line-height:1.75;text-align:justify;word-spacing:.1em}.quoteblock blockquote{border:0;margin:0;padding:0}.quoteblock blockquote:before{color:#7a2518;content:"\201c";float:left;font-size:2.75em;font-weight:700;line-height:.6em;margin-left:-.6em;text-shadow:0 1px 2px rgba(0,0,0,.1)}.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}.quoteblock .attribution{margin-right:.5ex;margin-top:.75em;text-align:right}.verseblock{margin:0 1em 1.25em}.verseblock pre{text-rendering:optimizeLegibility;color:rgba(0,0,0,.85);font-family:Open Sans,DejaVu Sans,sans;font-size:1.15rem;font-weight:300}.verseblock pre strong{font-weight:400}.verseblock .attribution{margin-left:.5ex;margin-top:1.25rem}.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;font-style:italic;line-height:1.45}.quoteblock .attribution br,.verseblock .attribution br{display:none}.quoteblock .attribution cite,.verseblock .attribution cite{color:rgba(0,0,0,.6);display:block;letter-spacing:-.025em}.quoteblock.abstract blockquote:before,.quoteblock.excerpt blockquote:before,.quoteblock .quoteblock blockquote:before{display:none}.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}.quoteblock.abstract{display:block;margin:0 1em 1.25em}.quoteblock.abstract>.title{font-size:1.15em;margin:0 0 .375em;text-align:center}.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{border-left:.25em solid #dddddf;padding:0 0 .25em 1em}.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;margin-right:0;text-align:left}p.tableblock:last-child{margin-bottom:0}td.tableblock>.content{word-wrap:anywhere;margin-bottom:1.25em}td.tableblock>.content>:last-child{margin-bottom:-1.25em}table.tableblock,td.tableblock,th.tableblock{border:0 solid #dedede}table.grid-all>*>tr>*{border-width:1px}table.grid-cols>*>tr>*{border-width:0 1px}table.grid-rows>*>tr>*{border-width:1px 0}table.frame-all{border-width:1px}table.frame-ends{border-width:1px 0}table.frame-sides{border-width:0 1px}table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}table.frame-ends>*>tr>:first-child,table.frame-none>*>tr>:first-child{border-left-width:0}table.frame-ends>*>tr>:last-child,table.frame-none>*>tr>:last-child{border-right-width:0}table.stripes-all tr,table.stripes-even tr:nth-of-type(2n),table.stripes-hover tr:hover,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}td.halign-left,th.halign-left{text-align:left}td.halign-right,th.halign-right{text-align:right}td.halign-center,th.halign-center{text-align:center}td.valign-top,th.valign-top{vertical-align:top}td.valign-bottom,th.valign-bottom{vertical-align:bottom}td.valign-middle,th.valign-middle{vertical-align:middle}table tfoot th,table thead th{font-weight:700}tbody tr th{background:#f7f8f7}tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:700}p.tableblock>code:only-child{background:none;padding:0}p.tableblock{font-size:1em}ol{margin-left:1.75em}ul li ol{margin-left:1.5em}dl dd{margin-left:1.125em}dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}.olist .olist,.olist .ulist,.ulist .olist,.ulist .ulist,ol>li p,ol dd,ul>li p,ul dd{margin-bottom:.625em}ol.no-bullet,ol.none,ol.unnumbered,ol.unstyled,ul.checklist,ul.no-bullet,ul.none,ul.unstyled{list-style-type:none}ol.no-bullet,ol.unnumbered,ul.no-bullet{margin-left:.625em}ol.unstyled,ul.unstyled{margin-left:0}ul.checklist{margin-left:.625em}ul.checklist li>p:first-child>.fa-check-square-o:first-child,ul.checklist li>p:first-child>.fa-square-o:first-child{bottom:.125em;font-size:.8em;position:relative;width:1.25em}ul.checklist li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}ul.inline>li{margin-left:1.25em}.unstyled dl dt{font-style:normal;font-weight:400}ol.arabic{list-style-type:decimal}ol.decimal{list-style-type:decimal-leading-zero}ol.loweralpha{list-style-type:lower-alpha}ol.upperalpha{list-style-type:upper-alpha}ol.lowerroman{list-style-type:lower-roman}ol.upperroman{list-style-type:upper-roman}ol.lowergreek{list-style-type:lower-greek}.colist>table,.hdlist>table{background:none;border:0}.colist>table>tbody>tr,.hdlist>table>tbody>tr{background:none}td.hdlist1,td.hdlist2{padding:0 .625em;vertical-align:top}td.hdlist1{font-weight:700;padding-bottom:1.25em}td.hdlist2{word-wrap:anywhere}.listingblock+.colist,.literalblock+.colist{margin-top:-.5em}.colist td:not([class]):first-child{line-height:1;padding:.4em .75em 0;vertical-align:top}.colist td:not([class]):first-child img{max-width:none}.colist td:not([class]):last-child{padding:.25em 0}.th,.thumb{border:4px solid #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd;display:inline-block;line-height:0}.imageblock.left{margin:.25em .625em 1.25em 0}.imageblock.right{margin:.25em 0 1.25em .625em}.imageblock>.title{margin-bottom:0}.imageblock.th,.imageblock.thumb{border-width:6px}.imageblock.th>.title,.imageblock.thumb>.title{padding:0 .125em}.image.left,.image.right{display:inline-block;line-height:0;margin-bottom:.25em;margin-top:.25em}.image.left{margin-right:.625em}.image.right{margin-left:.625em}a.image{display:inline-block;text-decoration:none}a.image object{pointer-events:none}sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}sup.footnote a,sup.footnoteref a{text-decoration:none}sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}#footnotes{margin-bottom:.625em;padding-bottom:.75em;padding-top:.75em}#footnotes hr{border-width:1px 0 0;margin:-.25em 0 .75em;min-width:6.25em;width:20%}#footnotes .footnote{font-size:.875em;line-height:1.3334;margin-bottom:.2em;margin-left:1.2em;padding:0 .375em 0 .225em}#footnotes .footnote a:first-of-type{font-weight:700;margin-left:-1.05em;text-decoration:none}#footnotes .footnote:last-of-type{margin-bottom:0}#content #footnotes{margin-bottom:0;margin-top:-.625em;padding:.75em 0}.gist .file-data>table{background:#fff;border:0;margin-bottom:0;width:100%}.gist .file-data>table td.line-data{width:99%}div.unbreakable{page-break-inside:avoid}.big{font-size:larger}.small{font-size:smaller}.underline{text-decoration:underline}.overline{text-decoration:overline}.line-through{text-decoration:line-through}.aqua{color:#00bfbf}.aqua-background{background:#00fafa}.black{color:#000}.black-background{background:#000}.blue{color:#0000bf}.blue-background{background:#0000fa}.fuchsia{color:#bf00bf}.fuchsia-background{background:#fa00fa}.gray{color:#606060}.gray-background{background:#7d7d7d}.green{color:#006000}.green-background{background:#007d00}.lime{color:#00bf00}.lime-background{background:#00fa00}.maroon{color:#600000}.maroon-background{background:#7d0000}.navy{color:#000060}.navy-background{background:#00007d}.olive{color:#606000}.olive-background{background:#7d7d00}.purple{color:#600060}.purple-background{background:#7d007d}.red{color:#bf0000}.red-background{background:#fa0000}.silver{color:#909090}.silver-background{background:#bcbcbc}.teal{color:#006060}.teal-background{background:#007d7d}.white{color:#bfbfbf}.white-background{background:#fafafa}.yellow{color:#bfbf00}.yellow-background{background:#fafa00}span.icon>.fa{cursor:default}a span.icon>.fa{cursor:inherit}.admonitionblock td.icon [class^="fa icon-"]{cursor:default;font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5)}.admonitionblock td.icon .icon-note:before{color:#19407c;content:"\f05a"}.admonitionblock td.icon .icon-tip:before{color:#111;content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8)}.admonitionblock td.icon .icon-warning:before{color:#bf6900;content:"\f071"}.admonitionblock td.icon .icon-caution:before{color:#bf3400;content:"\f06d"}.admonitionblock td.icon .icon-important:before{color:#bf0000;content:"\f06a"}.conum[data-value]{background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;display:inline-block;font-family:Open Sans,DejaVu Sans,sans-serif;font-size:.75em;font-style:normal;font-weight:700;height:1.67em;line-height:1.67em;text-align:center;width:1.67em}.conum[data-value],.conum[data-value] *{color:#fff!important}.conum[data-value]+b{display:none}.conum[data-value]:after{content:attr(data-value)}pre .conum[data-value]{position:relative;top:-.125em}b.conum *{color:inherit!important}.conum:not([data-value]):empty{display:none}div.footnote,dt,td.content,th.tableblock{text-rendering:optimizeLegibility}h1,h2,p,span.alt,td.content{letter-spacing:-.01em}div.footnote strong,p strong,td.content strong{letter-spacing:-.005em}blockquote,dt,p,span.alt,td.content{font-size:1.0625rem}p{margin-bottom:1.25rem}.sidebarblock dt,.sidebarblock p,.sidebarblock td.content,p.tableblock{font-size:1em}.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}.print-only{display:none!important}@page{margin:1.25cm .75cm}@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}html{font-size:80%}a{color:inherit!important;text-decoration:underline!important}a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}abbr[title]:after{content:" (" attr(title) ")"}blockquote,img,object,pre,svg,tr{page-break-inside:avoid}thead{display:table-header-group}svg{max-width:100%}blockquote,dt,p,td.content{font-size:1em;orphans:3;widows:3}#toctitle,.sidebarblock>.content>.title,h2,h3{page-break-after:avoid}#content,#footer,#footnotes,#header{max-width:none}#toc,.exampleblock>.content,.sidebarblock{background:none!important}#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}body.book #header{text-align:center}body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}body.book #header .details{border:0!important;display:block;padding:0!important}body.book #header .details span:first-child{margin-left:0!important}body.book #header .details br{display:block}body.book #header .details br+span:before{content:none!important}body.book #toc{border:0!important;margin:0!important;padding:0!important;text-align:left!important}body.book #preamble,body.book #toc,body.book .sect1>h2,body.book h1.sect0{page-break-before:always}.listingblock code[data-lang]:before{display:block}#footer{padding:0 .9375em}.hide-on-print{display:none!important}.print-only{display:block!important}.hide-for-print{display:none!important}.show-for-print{display:inherit!important}}@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}.sect1{padding:0!important}.sect1+.sect1{border:0}#footer{background:none}#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}@media amzn-kf8{#content,#footer,#footnotes,#header{padding:0}}</style><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css"></head><body class="article"> <div id="header"> <h1>Railroad Oriented Programming in C#</h1> </div> <div id="content"> <div class="sect1"> <h2 id="_the_problem_implicit_function_failure">The problem: implicit function failure</h2> <div class="sectionbody"> <div class="paragraph"> <p>Functions are often designed for the <strong>success path</strong>: the output type only consists of the type the function will return in case of a successful execution. The following function definition likely wouldn&#8217;t stand out in an average code base.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight highlightjs"><code class="hljs language-cs" data-lang="cs">string GetEmailAddress(string username)
{
  // ...
}</code></pre> </div> </div> <div class="paragraph"> <p>This function is supposed to return an email address for a user with the username that is passed into the function. If the function isn&#8217;t able to meet this expectation, e.g. because the user doesn&#8217;t exist, or it has no email address defined, usually one of the following things happens.</p> </div> <div class="arabic olist"> <ol class="arabic"> <li> <p>A default value is returned, such as a null reference.</p> </li> <li> <p>An exception is thrown.</p> </li> </ol> </div> <div class="literalblock"> <div class="content"> <pre>blockdiag {
username -&gt; GetEmailAddress -&gt; emailAddress;
GetEmailAddress -&gt; "?";
"?" [color = "orange"];
"emailAddress" [color = "lightblue"];
}</pre> </div> </div> <div class="sect2"> <h3 id="_problems_with_using_default_values_for_failure">Problems with using default values for failure</h3> <div class="ulist"> <ul> <li> <p>For <strong>value types</strong> the default value is a valid member of the value space of the type. So there would be no way to distinguish between a success return value and a failure return value in this case.</p> </li> <li> <p>For <strong>reference types</strong> the default value is not a valid member of the value space. However, null references have their own set of problems. (Since the addition of nonnullable reference types in C# 8.0 this set of problems has been diminished a great deal, but a non-negligible pool of pitfalls remains.)</p> </li> <li> <p>There is no way to return any data along with the failure, such as an error message or some object indicating the reason or nature of the failure.</p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="_problems_with_using_exceptions_for_failure">Problems with using exceptions for failure</h3> <div class="ulist"> <ul> <li> <p>Exceptions are not part of the function signature. As such a caller of a function does not know which exceptions to catch unless he reads all the code that is possibly hit by the function, assuming that he even has access to it.</p> </li> <li> <p>In well-defined and well-maintained APIs the list of possible exceptions a function can throw is stated in the documentation. However:</p> <div class="ulist"> <ul> <li> <p>The user of the API can easily overlook exceptions without compiler warnings.</p> </li> <li> <p>If the API changes over time and adds more exceptions, the user will not be notified of this by the compiler, simply because the compiler doesn&#8217;t know anything about the exceptions a function can throw.</p> </li> <li> <p>Most functions are not part of a well-defined API.</p> </li> </ul> </div> </li> </ul> </div> </div> <div class="sect2"> <h3 id="_the_problem_of_implicit_failure_in_general">The problem of implicit failure in general</h3> <div class="paragraph"> <p>While the above paragraphs point out some problems with the respective failure-handling strategies, perhaps the biggest of all problems is this: the <strong>failure path</strong> of <code>GetEmailAddress</code> is <strong>implicitly defined</strong>. As such, it doesn&#8217;t get the same amount of attention as the success path and is, frankly, too often completely overlooked. This is not surprising, since either of the strategies leaves the compiler clueless and unable to help the programmer to write code that properly handles failures.</p> </div> </div> <div class="sect2"> <h3 id="_solution_explicit_failure">Solution: explicit failure</h3> <div class="paragraph"> <p>The solution is fairly straightforward: make the failure path part of the normal returntype of the function. Have the returntype resemble that the function can return with a failure object.</p> </div> <div class="literalblock"> <div class="content"> <pre>blockdiag {
username -&gt; GetEmailAddress -&gt; emailAddress;
GetEmailAddress -&gt; "userNotFound";
"emailAddress" [color = "lightblue"];
"userNotFound" [color = "orange"];
}</pre> </div> </div> <div class="paragraph"> <p>This sounds trivial, so why isn&#8217;t this done traditionally? At least part of that has to do with the fact C-like languages do not make it easy to do this. You would need to have a returntype that can be <em>either</em> the success type <em>or</em> the failure type. In functional programming languages such a construct <em>does</em> exist and is called a <a href="https://en.wikipedia.org/wiki/Tagged_union">Discriminated Union</a>. But C-like languages, including C#, do not have support for such a type. Luckily C# has had added lots of language features over the years that make it possible to emulate discriminated unions in a neat way. We will have a look at one way of implementing explicit failure in C#: a <code>Result</code> type with two types of possible instances. One for the success path, and one for the failure path.</p> </div> </div> <div class="sect2"> <h3 id="_there_is_still_a_place_for_exceptions">There is still a place for exceptions</h3> <div class="paragraph"> <p>Making the failure path part of the function returntype does not mean that there are no exceptional situations for which the exception throwing mechanism is a good fit. To give an extreme example, almost any function can <em>in theory</em> encounter an <code>OutOfMemoryException</code> while doing an allocation. Or any function could <em>in theory</em> contain a bug causing a <code>NullReferenceException</code> to be thrown. But this does not mean that we should write every function with that in mind, and have it be part of the normal failure path. These cases are really exceptions which are <strong>unexpected</strong>, and should not happen. There is often no proper way to handle them other than to cancel the whole "operation" and present the user with an appropriate error, indicating that something went completely sideways.</p> </div> <div class="paragraph"> <p>A good way for deciding whether to propagate a failure by throwing an exception is by asking the following question. <em>Would the exeption be handled with no error-specific logic and should it cause the entire operation that is being done to be aborted</em>? If the answer is yes, then it is probably appropriate to let the failure be handled by throwing an exception and catch it up the callchain at the "edge of the operation".</p> </div> <div class="paragraph"> <p>What the scope of that "operation" should be is completely context dependent. For instance, in a web application that could be the http request. In other contexts, like a CLI progam, it could be the whole process. Again, note that the edges of the code that constitutes an "operation" should have appropriate try/catch clauses.</p> </div> <div class="paragraph"> <p>Tldr, exceptions should not be dealt with on a function level but rather on an "operation" level, and they are really <strong>exceptional</strong>.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_implementing_a_result_type_supporting_the_failure_path">Implementing a Result type supporting the failure path</h2> <div class="sectionbody"> <div class="paragraph"> <p>While C# does not directory support Discriminated Unions, it does support subclassing. Since a class can have multiple subclasses, and any object is always just one of them, we can use this phenomenon to implement the notion of having two returntypes, one for success result, and one for the failure result.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight highlightjs"><code class="hljs language-cs" data-lang="cs">abstract class Result {
  class Success : Result { }
  class Failure : Result { }
  // Private constructor so we are certain that Success and Failure are the only subclasses
  private Result () { }
}</code></pre> </div> </div> <div class="paragraph"> <p>However, this class does not allow us to associate any return data with either the success or the failure result. We can fix that.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight highlightjs"><code class="hljs language-cs" data-lang="cs">abstract class Result&lt;TResult, TError&gt; {
  sealed class Success : Result&lt;TResult, TError&gt; {
    public readonly TResult ResultValue;
    public Success(TResult result){
      ResultValue = result;
    }
  }
  sealed class Failure : Result&lt;TResult, TError&gt; {
    public readonly TError ErrorValue;
    public Failure(TError error){
      ErrorValue = error;
    }
  }
  // Private constructor so we are certain that Success and Failure are the only subclasses
  private Result () { }
}</code></pre> </div> </div> <div class="paragraph"> <p>With this in our toolkit we can now implement our <code>GetEmailAddress</code> function from earlier with an explicit failure path.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight highlightjs"><code class="hljs language-cs" data-lang="cs">Result&lt;string, string&gt; GetEmailAddress(string username)
{
  var user = GetUser(username);
  if (user != null) {
    var email = user.Email;
    if (!string.IsNullOrEmpty(email))
    {
      return new Success(email);
    }
    return new Failure("User has no email");
  }
  return new Failure("User does not exist");
}</code></pre> </div> </div> <div class="paragraph"> <p>Usage of this function would look something like</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight highlightjs"><code class="hljs language-cs" data-lang="cs">var result = GetEmailAddress(username);
if (result is Result&lt;string,string&gt;.Success) {
  var email = ((Result&lt;string,string&gt;.Success)result).ResultValue;
  // Do what you wanna do
} else {
  var error = ((Result&lt;string,string&gt;.Failure)result).ErrorValue;
  // Handle the failure appropriately
}</code></pre> </div> </div> <div class="paragraph"> <p>As you can see we&#8217;ve achieved an explicit failure path. But the code leaves much to be desired. Even more so when we need to call more than one function.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight highlightjs"><code class="hljs language-cs" data-lang="cs">Result&lt;EmailMessage, string&gt; CreateEmailMessage(string emailaddress) { ... }

// ...

var result = GetEmailAddress(username);
if (result is Result&lt;string,string&gt;.Success) {
  var email = ((Result&lt;string,string&gt;.Success)result).ResultValue;
  var result2 = CreateEmailMessage(email);
  if (result2 is Result&lt;EmailMessage,string&gt;.Success) {
    var message = ((Result&lt;EmailMessage,string&gt;.Success)result2).ResultValue;
    // And so on...
  } else {
    var error2 = ((Result&lt;EmailMessage,string&gt;.Failure)result).ErrorValue;
    // Handle the failure appropriately
  }
} else {
  var error = ((Result&lt;string,string&gt;.Failure)result).ErrorValue;
  // Handle the failure appropriately
}</code></pre> </div> </div> <div class="paragraph"> <p>We would like to</p> </div> <div class="ulist"> <ul> <li> <p>not have to type cast or type check</p> </li> <li> <p>not have a new nesting level for each new function we call</p> </li> </ul> </div> </div> </div> <div class="sect1"> <h2 id="_implementing_a_result_type_supporting_railroad_oriented_programming">Implementing a Result type supporting railroad oriented programming</h2> <div class="sectionbody"> <div class="listingblock"> <div class="content"> <pre class="highlight highlightjs"><code class="hljs language-cs" data-lang="cs">abstract class Result&lt;TResult, TError&gt; {

  abstract Result&lt;TNextResult, TError&gt; OnSuccess&lt;TNextResult&gt;(Func&lt;TResult, Result&lt;TNextResult, TError&gt;&gt; onSuccess);
  abstract TReturn Handle&lt;TReturn&gt;(Func&lt;TResult, TReturn&gt; onSuccess, Func&lt;TError, TReturn&gt; onFailure);

  sealed class Success : Result&lt;TResult, TError&gt; {
    public readonly TResult ResultValue;
    public Success(TResult result){
      Result = result;
    }
    public override Result&lt;TNextResult, TError&gt; OnSuccess&lt;TNextResult&gt;(Func&lt;TResult, Result&lt;TNextResult, TError&gt;&gt; onSuccess)
      =&gt; onSuccess(ResultValue);
    public override TReturn Handle&lt;TReturn&gt;(Func&lt;TResult, TReturn&gt; onSuccess, Func&lt;TError, TReturn&gt; onFailure)
      =&gt; onSuccess(ResultValue);
  }

  sealed class Failure : Result&lt;TResult, TError&gt; {
    public readonly TError ErrorValue;
    public Failure(TError error){
      ErrorValue = error;
    }
    public override Result&lt;TNextResult, TError&gt; OnSuccess&lt;TNextResult&gt;(Func&lt;TResult, Result&lt;TNextResult, TError&gt;&gt; onSuccess)
      =&gt; new Failure(ErrorValue);
    public override TReturn Handle&lt;TReturn&gt;(Func&lt;TResult, TReturn&gt; onSuccess, Func&lt;TError, TReturn&gt; onFailure)
      =&gt; onFailure(Error);
  }
  private Result () { }
}</code></pre> </div> </div> <div class="listingblock"> <div class="content"> <pre class="highlight highlightjs"><code class="hljs language-cs" data-lang="cs">var result = GetEmailAddress(username)
  .OnSuccess(email =&gt; CreateEmailMessage(email));
  .Handle(
    message =&gt; ...,
    error =&gt; ...
  );</code></pre> </div> </div> </div> </div> </div> <div id="footer"> <div id="footer-text"> Last updated 2021-07-13 17:05:17 +0200 </div> </div> <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script> <script>hljs.initHighlighting.called||(hljs.initHighlighting.called=!0,[].slice.call(document.querySelectorAll("pre.highlight > code")).forEach((function(l){hljs.highlightBlock(l)})));</script> </body></html>